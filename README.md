# Mechanism Converter to SSH-aerosol v2.0

This program converts given atmospheric chemical mechanisms from MCM (FACSIMILE) or GECKO format to the SSH-aerosol v2.0 format.

## Scripts

The program includes several scripts, each serving a specific function in the conversion process:

1. **Converty.py**: The main script for conversion. All user-defined parameters are set in this script.
2. **DataStream.py**: Handles reading and writing data from/to files. This script is adapted from the GENOA DataStream.py code.
3. **KineticRateToSSH.py**: Converts kinetic rates from MCM or GECKO formats to SSH-aerosol v2.0 format. This script is adapted from the GENOA KineticRateToSSH.py code.
4. **Module.py**: Defines the classes for species and reactions in the mechanism. Adapted from the GENOA Module.py code.
5. **MolProperty.py**: Calculates molecular properties based on SMILES strings. This script is adapted from the GENOA MolProperty.py code.
   - **Note**: This script requires the `OpenBabel` and `UManSysProp` (Currently included in this git version) packages to be installed.

## Installation of Dependencies

To install required OpenBabel, you can use conda:

    conda install -c conda-forge openbabel

## Usage

### Step 1: To convert a mechanism, the user must specify the following parameters in the `Converty.py` script:
    
   1. **output_dir**: Path to the output directory.
   2. **IDchem**: Identifier for the output mechanism.
   3. **reaction_file**: Path to the file containing the mechanism.
   4. **reaction_type**: Type of the reaction mechanism (e.g., `FACSMILE` for MCM, `GECKO, `SSH`).

   For conversion of MCM and SSH mechanisms, the user must also specify:
   1. **species_file**: Path to the file containing the species information.
   2. **species_type**: Type of the species information (e.g., `MCM`, `GECKO`, `SSH`).

   To include aerosol properties, the user can specify:
   1. **soap_file**: Path to the file containing the SOAP decomposition information. This file is generated by running SSH-aerosol with the aerosol species list `[name].aer.1st`.
   2. **vpType**: Type of saturation vapor pressure computation (e.g., `simpol`).
   3. **psat_nvoc**: Set aerosols to non-volatile if Psat < psat_nvoc in atm.
   4. **psat_svoc**: Set aerosols to volatile if Psat > psat_svoc in atm.

   Please check the script for additional parameters and details.

### Step 2: After setting the parameters, run the `Converty.py` script to convert the mechanism to SSH-aerosol v2.0 format.

   The output mechanism will be saved in the specified output directory with the given identifier.

   The script will generate the following output files in the specified output directory:
    1. `[IDchem].species`: Species list file that can be directly used in the SSH-aerosol simulations.
    2. `[IDchem].reactions`: Reaction list file that can be directly used in the SSH-aerosol simulations.
    3. `[IDchem].aer.1st`: Aerosol species list file that contains SMILES structures, where the aerosol species are disconnected to their precursors (Precursors for ogranic aerosols are not specified). This file is used to generate the SOAP output information required to further convert this mechanism with functional group decomposition.
    4. `[IDchem].aer`: Aerosol species list file that contains SMILES structures, where the aerosol species are connected to their precursors. This file can be used to obtain the SOAP output information along with the generated species file, and also to run the SSH-aerosol simulations with SMILES structures.
   5. `[IDchem].aer.vec`: Aerosol species list file that contains functional group decomposition information. This file can be used to run the SSH-aerosol simulations.
   6. `[IDchem].mol`: Molecular properties file that contains the molecular properties of all the species in the mechanism. Togehter with the reaction file, this file can be used in the converter and GENOA to import a mechanism in the SSH-aerosol format.

   Please check the converted mechanisms before using. Some manual modifications may be required to ensure the mechanism is correctly converted. For example, kinetic rate constants that can not be converted will be set to `!!!` in the output reaction file. The user should manually update these values.


### Step 3: To run the SSH-aerosol model with the converted mechanism, the user may neet specify the following parameters in the SSH-aerosol namelist:

   1. **species_list_file**: Make sure the species list file is consistent with the initial and constant concentration files used in the namelist.
   2. **aerosol_species_list_file**: Make sure the aerosol concentrations are consistent with the aerosol species list file used in the namelist. For the fist time running converted mechanism, please use `[name].aer.1st` file to generate the **soap output information** required to convert a mechansim with functional group decomposition.
   3. **reaction_list_file**: If the mechanism is converted from GECKO, please also provide the corresponding `photolysis_file` in the namelist.
   4. **RO2_list_file**: It is an optional file that only needs to be specified if the mechanism contains RO2-RO2 reactions (`tag_RO2` > 0 in the namelist).

## Example Usage:

   Two example mechanisms are provided in the `input` folder:
   - `API2_GECKO-A`: GECKO mechanism for 2-generation apinene degradation.
   - `mcm_API_reactions.fac` and `mcm_API_species.tsv`: MCM mechanism for a-pinene degradation.

   Those mechanism files can be used to test the conversion script. The example outputs in SSH-aerosol v2.0 format are provided in the `output` folder.
